# Tags API

Manage tags, tag preferences, and get personalized tag summaries.

## Endpoints

### GET /api/tags

Get all tags ordered by usage count.

**Query Parameters:**
- `page` (default: 1): Page number
- `pageSize` (default: 50): Items per page

**Response:**
```json
{
  "tags": [
    {
      "id": 1,
      "name": "technology",
      "usageCount": 150
    }
  ],
  "totalCount": 500,
  "page": 1,
  "pageSize": 50
}
```

---

### GET /api/tags/user

Get user's tag preferences grouped by interaction type.

**Authentication:** Required

**Query Parameters:**
- `userId` (required): User ID

**Response:**
```json
[
  {
    "tagId": 1,
    "tagName": "technology",
    "interactionType": "Explicit",
    "score": 5.5,
    "interactionCount": 3
  }
]
```

---

### POST /api/tags/interest

Mark tags as explicitly interesting. This is the strongest signal.

**Authentication:** Required

**Query Parameters:**
- `userId` (required): User ID

**Request Body:**
```json
{
  "tagIds": [1, 2, 3]
}
```

**Response:**
```json
{
  "message": "Tag interests updated"
}
```

---

### POST /api/tags/ignore

Mark tags to explicitly ignore. Content with these tags won't be recommended.

**Authentication:** Required

**Query Parameters:**
- `userId` (required): User ID

**Request Body:**
```json
{
  "tagIds": [4, 5]
}
```

**Response:**
```json
{
  "message": "Tags marked as ignored"
}
```

---

### GET /api/tags/summary

Get tag summary with time-based decay applied. This is what powers recommendations.

**Authentication:** Required

**Query Parameters:**
- `userId` (required): User ID

**Response:**
```json
{
  "tagScores": {
    "technology": 8.5,
    "programming": 6.2,
    "science": 4.1
  },
  "lastUpdated": "2024-01-01T12:00:00Z"
}
```

## Examples

### List All Tags

```bash
curl http://localhost:8080/api/tags
```

### Get User's Tag Preferences

```bash
curl -H "Authorization: Bearer YOUR_TOKEN" \
  http://localhost:8080/api/tags/user?userId=YOUR_USER_ID
```

### Mark Tags as Interesting

```bash
curl -X POST \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"tagIds": [1, 5, 10]}' \
  http://localhost:8080/api/tags/interest?userId=YOUR_USER_ID
```

### Ignore Tags

```bash
curl -X POST \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"tagIds": [7, 8]}' \
  http://localhost:8080/api/tags/ignore?userId=YOUR_USER_ID
```

### Get Tag Summary

```bash
curl -H "Authorization: Bearer YOUR_TOKEN" \
  http://localhost:8080/api/tags/summary?userId=YOUR_USER_ID
```

## Tag Properties

| Property | Type | Description |
|----------|------|-------------|
| id | number | Unique tag identifier |
| name | string | Tag name |
| usageCount | number | Number of articles with this tag |

## Interaction Types

Tags can be associated with users through different interaction types:

### Explicit (+5 points)
User explicitly marked the tag as interesting. This is the strongest signal.

### Ignored (-10 points)
User explicitly wants to avoid content with this tag. Articles with ignored tags are filtered out of recommendations.

### Clicked (+1 point)
User clicked an article that has this tag. Implicit interest signal.

### Liked (+3 points)
User liked an article that has this tag. Strong interest signal.

## Tag Score Calculation

The final tag score considers:
1. **Interaction points**: Based on interaction type
2. **Interaction count**: More interactions = more stable
3. **Decay factor**: Applied when new interactions occur
4. **Time decay**: (Future enhancement) Gradual decay over time

### Decay Formula

When new interactions occur, existing scores are decayed:

```
newScore = oldScore × e^(-decayRate × newCount / oldCount)
```

This means:
- Tags with more interactions decay slower
- Tags with fewer interactions decay faster
- Recent interests naturally become more prominent
- Old interests fade but don't disappear completely

## Tag Recommendations

The tag summary is used to:
- Recommend articles with high-scoring tags
- Suggest new feeds based on tag preferences
- Filter out content with ignored tags
- Discover related tags through co-occurrence

## Tag Relationships

Tags that appear together in articles are tracked:
- Co-occurrence counting
- Similarity scoring
- Used for "related tags" features
- Helps discover new interests

## Best Practices

### For Users
- Start by marking 5-10 tags as interesting
- Click articles you find interesting
- Like articles you love
- Ignore tags you don't want to see
- Preferences evolve naturally with use

### For Developers
- Tags are created automatically by the LLM
- Don't delete tags with articles
- Clean up unused tags periodically
- Monitor tag quality from the LLM
- Adjust decay rates based on feedback

## Notes

- Tags are automatically generated by the LLM during article ingestion
- Tag names are normalized (lowercase, trimmed)
- Duplicate tag names are prevented
- Unused tags may be cleaned up periodically
- Tag preferences are personal and private
